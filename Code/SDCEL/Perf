#!/bin/bash

POSITIONAL_ARGS=()
while [[ $# -gt 0 ]]; do
    case $1 in
	-d|--dataset)
	    DATASET="$2"
	    shift
	    shift
	    ;;
	-t|--tolerance)
	    TOLERANCE="$2"
	    shift # past argument
	    shift # past value
	    ;;
	-f|--first)
	    FIRST="$2"
	    shift # past argument
	    shift # past value
	    ;;
	-i|--increment)
	    INCREMENT="$2"
	    shift # past argument
	    shift # past value
	    ;;
	-l|--last)
	    LAST="$2"
	    shift # past argument
	    shift # past value
	    ;;
	-n|--iterations)
	    N="$2"
	    shift # past argument
	    shift # past value
	    ;;	
	-p|--partitions)
	    PARTITIONS="$2"
	    shift # past argument
	    shift # past value
	    ;;	
	-m|--master)
	    MASTER="$2"
	    shift # past argument
	    shift # past value
	    ;;	
	-o|--ooption)
	    OOPTION="$2"
	    shift # past argument
	    shift # past value
	    ;;	
	--debug)
	    DEBUG="--debug"
	    shift # past argument
	    ;;
	-*|--*)
	    echo "Unknown option $1"
	    exit 1
	    ;;
	*)
	    POSITIONAL_ARGS+=("$1") # save positional arg
	    shift # past argument
	    ;;
    esac
done
set -- "${POSITIONAL_ARGS[@]}" # restore positional parameters

echo "DATASET    = ${DATASET}"
echo "TOLERANCE  = ${TOLERANCE}"

if [ -z ${PARTITIONS+x} ] # if PARTITIONS does not exist...
then 
    PS=(`seq $FIRST $INCREMENT $LAST`)
    echo "FIRST      = ${FIRST}"
    echo "INCREMENT  = ${INCREMENT}"
    echo "LAST       = ${LAST}"    
else 
    PS=(`seq $PARTITIONS 1 $PARTITIONS`)    
    echo "PARTITIONS = ${PARTITIONS}"
fi

if [ -v N ];      then echo "ITERATIONS = ${N}"; else N=1; fi
if [ -v DEBUG ];  then echo "DEBUG      = YES";  else DEBUG=""; fi
if [ -v OOPTION ]; then echo "OOPTION    = ${OOPTION}"; else OOPTION=0; fi
if [ -v MASTER ]
then
    echo "MASTER     = ${MASTER}"
else
    MASTER="yarn"
    echo "MASTER     = yarn"
fi

#PS=(5000)

for n in $(seq 1 $N)
do
    for P in "${PS[@]}"
    do
	echo "Run $n ./sdcel2_debug $DATASET/P$P /home/acald013/RIDIR/local_path/$DATASET/P$P/ $TOLERANCE \"${P}_${DATASET}_${TOLERANCE}_${n}\" ${MASTER} ${DEBUG}"
	./sdcel2_debug $DATASET/P$P /home/acald013/RIDIR/local_path/$DATASET/P$P/ $TOLERANCE "${P}_${DATASET}_${TOLERANCE}_${n}" $MASTER $OOPTION $DEBUG
    done
done
